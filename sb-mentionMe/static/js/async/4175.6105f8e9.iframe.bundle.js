"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["4175"],{"./src/shared/components/ContentItemEditor/ContentItemEditor.tsx":function(e,t,n){n.d(t,{Z:()=>E});var i=n("../node_modules/react/jsx-runtime.js"),a=n("../node_modules/react/index.js"),l=n("../node_modules/@apollo/client/react/hooks/useQuery.js"),r=n("./src/shared/context/PlaceholdersContext.tsx"),d=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),o=n("../node_modules/@tiptap/react/dist/index.js"),s=n("../node_modules/react-i18next/dist/es/index.js"),m=n("../node_modules/@tiptap/core/dist/index.js"),u=n("../node_modules/@tiptap/starter-kit/dist/index.js");let c=e=>new DOMParser().parseFromString(e,"text/html").body.textContent??"",p="((?:{{)([A-Za-z0-9\\-]+)(?:}}))",k=function(e,t,n){var i;let a=!(arguments.length>3)||void 0===arguments[3]||arguments[3],l=null==e?void 0:null===(i=e.find(e=>{let{tag:n}=e;return n===t}))||void 0===i?void 0:i.value;return a&&l&&(l=c(l)),l??n(`shared:content-item-editor.placeholders.${t}`,t)},g=m.NB.create({name:"Placeholder",group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({title:{default:null}}),addInputRules(){return[(0,m.x2)({find:RegExp(`${p}$`),type:this.type,getAttributes:e=>{let[,,t]=e;return{title:t}}})]},addPasteRules(){return[(0,m.Ss)({find:RegExp(p,"g"),type:this.type,getAttributes:e=>{let[,,t]=e;return{title:t}}})]},renderHTML(e){let{HTMLAttributes:t}=e;return["mark",(0,m.P1)(t),this.options.getValue(t.title)]},parseHTML:()=>[{tag:"mark"}],renderText(e){let{node:t}=e;return`{{${t.attrs.title}}}`}}),v=(e,t,n,i,l,r)=>{let{t:d}=(0,s.$G)("shared"),m=(0,a.useCallback)(e=>{n([...e.matchAll(RegExp(p,"g"))].map(e=>{let[,,t]=e;return t}))},[n]),c=(0,a.useMemo)(()=>(l??(null==e?void 0:e.template)??"").replace(RegExp(p,"g"),(e,t,n)=>`<mark title="${n}">${k(i,n,d)}</mark>`),[l,null==e?void 0:e.template,i,d]),v=(0,a.useCallback)(e=>{let{editor:n}=e;if(n.isDestroyed)return;let a=n.getText({blockSeparator:"\n"});m(a),t(a);let l=a.replace(RegExp(p,"g"),(e,t,n)=>k(i,n,d));null==r||r(l.length)},[t,m,r,i,d]);(0,a.useEffect)(()=>{let t=l??(null==e?void 0:e.template)??"";m(t),null==r||r(t.length)},[null==e?void 0:e.template]);let h=(0,a.useCallback)(e=>k(i,e,d),[i,d]),y=(0,a.useMemo)(()=>({extensions:[u.Z,g.configure({getValue:h})],content:c,onUpdate:v,parseOptions:{preserveWhitespace:"full"}}),[h,v]);return(0,o.jE)(y,[y])};var h=n("../node_modules/styled-components/dist/styled-components.browser.esm.js");let y=(0,h.iv)(["padding:",";color:",";cursor:pointer;font-weight:",";text-align:center;border:2px solid ",";border-radius:20px;white-space:nowrap;"],(0,d.W0)([0,1]),(0,d.Ys)("NavyBase"),(0,d.Ue)("h5"),(0,d.Ys)("Navy80")),f=(0,h.iv)(["background-color:",";color:",";"],(0,d.Ys)("NavyBase"),(0,d.Ys)("White")),x=h.ZP.div.withConfig({displayName:"ContentItemEditorInner.styled__Header"})(["display:flex;justify-content:space-between;margin-bottom:",";"],(0,d.W0)(1)),N=h.ZP.div.withConfig({displayName:"ContentItemEditorInner.styled__Card"})(["padding:",";background-color:",";border:",";border-radius:",";"],(0,d.W0)(2),(0,d.Ys)("Grey80"),(0,d.Cg)(),(0,d.E0)("large")),b=h.ZP.div.withConfig({displayName:"ContentItemEditorInner.styled__Input"})([".ProseMirror{padding:",";border:1px solid ",";border-radius:",";background:",";color:",";}p{margin-bottom:0;}mark{"," ","}"],(0,d.W0)(1.5),(0,d.Ys)("Cornflower80"),(0,d.E0)("default"),(0,d.Ys)("White"),(0,d.Ys)("Navy80"),y,f),I=(0,h.ZP)(d.XS).withConfig({displayName:"ContentItemEditorInner.styled__Description"})(["margin:",";"],(0,d.W0)([2,0])),C=h.ZP.div.withConfig({displayName:"ContentItemEditorInner.styled__Footer"})(["display:flex;justify-content:space-between;"]),j=h.ZP.div.withConfig({displayName:"ContentItemEditorInner.styled__Tags"})(["display:flex;gap:",";flex-wrap:wrap;"],(0,d.W0)(1)),S=(0,h.ZP)(d.S).withConfig((0,d.NZ)("isOver")).withConfig({displayName:"ContentItemEditorInner.styled__Count"})(["color:",";white-space:nowrap;",""],(0,d.Ys)("GreenDark"),e=>{let{isOver:t}=e;return t&&(0,h.iv)(["color:",";"],(0,d.Ys)("RedDark"))}),_=(0,h.ZP)("div").withConfig((0,d.NZ)("isActive")).withConfig({displayName:"ContentItemEditorTag.styled__Wrapper"})(["font-size:",";line-height:18px;"," cursor:move;",""],(0,d.JB)("xs"),y,e=>{let{isActive:t}=e;return t&&f}),T=e=>{let{tag:t,isActive:n}=e,{t:a}=(0,s.$G)("shared");return(0,i.jsx)(_,{isActive:n,draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",`{{${t}}}`)},title:t,children:a(`content-item-editor.placeholders.${t}`,t)})};T.Skeleton=()=>(0,i.jsx)(_,{isActive:!1,children:(0,i.jsx)(d.Od,{width:50})});T.__docgenInfo={description:"",methods:[{name:"Skeleton",docblock:null,modifiers:["static"],params:[],returns:null}],displayName:"ContentItemEditorTag",props:{tag:{required:!0,tsType:{name:"string"},description:""},isActive:{required:!1,tsType:{name:"boolean"},description:""}}};let w=e=>{let{contentItem:t,title:n,clearAll:l,onChange:r,defaultValue:m,max:u,globalPlaceholders:c,placeholdersToShow:p}=e,{t:k}=(0,s.$G)("shared"),[g,h]=(0,a.useState)([]),[y,f]=(0,a.useState)(0),_=v(t,r,h,c,m,f);return(0,i.jsxs)("div",{children:[(0,i.jsxs)(x,{children:[(0,i.jsx)(d.H5,{children:n}),l&&(0,i.jsx)(d.BY,{as:"button",onClick:()=>null==_?void 0:_.commands.setContent("",!0),children:l})]}),(0,i.jsxs)(N,{children:[(0,i.jsx)(b,{children:(0,i.jsx)(o.kg,{editor:_})}),(0,i.jsx)(I,{children:k("content-item-editor.personalised-items","Drag these dynamic content items into the text editor to personalise your message:")}),(0,i.jsxs)(C,{children:[(0,i.jsx)(j,{children:p.map(e=>(0,i.jsx)(T,{tag:e.tag,isActive:g.includes(e.tag)},e.tag))}),u?(0,i.jsx)(S,{isOver:y>u,children:k("content-item-editor.count",{defaultValue:"Characters: {{ count }}/{{ max }}",count:y,max:u})}):null]})]})]})};w.Skeleton=e=>{let{title:t}=e,{t:n}=(0,s.$G)("shared");return(0,i.jsxs)("div",{children:[(0,i.jsx)(x,{children:(0,i.jsx)(d.H5,{children:t})}),(0,i.jsxs)(N,{children:[(0,i.jsx)(b,{children:(0,i.jsx)(d.Od,{width:"100%",height:46})}),(0,i.jsx)(I,{children:n("content-item-editor.personalised-items","Drag these dynamic content items into the text editor to personalise your message:")}),(0,i.jsx)(C,{children:(0,i.jsx)(j,{children:[1,2,3,4].map(e=>(0,i.jsx)(T.Skeleton,{},e))})})]})]})};w.__docgenInfo={description:"",methods:[{name:"Skeleton",docblock:null,modifiers:["static"],params:[{name:'{ title }: Pick<ContentItemEditorInnerProps, "title">',optional:!1,type:{name:"Pick",elements:[{name:"ContentItemEditorInnerProps"},{name:"literal",value:'"title"'}],raw:'Pick<ContentItemEditorInnerProps, "title">',alias:"Pick"}}],returns:null}],displayName:"ContentItemEditorInner",props:{contentItem:{required:!0,tsType:{name:"union",raw:'FetchContentItemQuery["contentItemByTag"]'},description:""},title:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(template: string) => void",signature:{arguments:[{type:{name:"string"},name:"template"}],return:{name:"void"}}},description:""},clearAll:{required:!1,tsType:{name:"string"},description:""},defaultValue:{required:!1,tsType:{name:"string"},description:""},globalPlaceholders:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ tag: string; value: string }",signature:{properties:[{key:"tag",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}}]}}],raw:"{ tag: string; value: string }[]"},description:""},placeholdersToShow:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ tag: string; value: string }",signature:{properties:[{key:"tag",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}}]}}],raw:"{ tag: string; value: string }[]"},description:""},max:{required:!1,tsType:{name:"number"},description:""}}};let P={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fetchContentItem"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tag"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"offerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contentItemContext"}},type:{kind:"NamedType",name:{kind:"Name",value:"ContentItemContextEnum"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentItemByTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"contentItemTag"},value:{kind:"Variable",name:{kind:"Name",value:"tag"}}},{kind:"Argument",name:{kind:"Name",value:"offerId"},value:{kind:"Variable",name:{kind:"Name",value:"offerId"}}},{kind:"Argument",name:{kind:"Name",value:"contentItemContext"},value:{kind:"Variable",name:{kind:"Name",value:"contentItemContext"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ContentItemFields"}},{kind:"Field",name:{kind:"Name",value:"alternativeEditable"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ContentItemFields"}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ContentItemFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ContentItemEditable"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"tag"}},{kind:"Field",name:{kind:"Name",value:"lastEditedDate"}},{kind:"Field",name:{kind:"Name",value:"lastRetrievedDate"}},{kind:"Field",name:{kind:"Name",value:"template"}},{kind:"Field",name:{kind:"Name",value:"stripMarkup"}},{kind:"Field",name:{kind:"Name",value:"personalisationTags"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tag"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"referencedTags"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tag"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"Field",name:{kind:"Name",value:"isDefault"}},{kind:"Field",name:{kind:"Name",value:"isOverridable"}},{kind:"Field",name:{kind:"Name",value:"specialRules"}}]}}]},F=e=>{let{tag:t,contentItemContext:n,offerId:d,title:o,placeholders:s,...m}=e,{loading:u,data:c}=(0,l.aM)(P,{variables:{offerId:d,tag:t,contentItemContext:n}}),{isLoading:p,globalPlaceholders:k}=(0,r.d)()??{},g=(0,a.useMemo)(()=>{var e;if(!s)return k??[];let t=[];return[...(null==c?void 0:null===(e=c.contentItemByTag)||void 0===e?void 0:e.referencedTags)||[],...k||[]].filter(e=>!!s.includes(e.tag)&&!t.includes(e.tag)&&(t.push(e.tag),!0)).sort()},[c,s,k]);return u||p?(0,i.jsx)(w.Skeleton,{title:o}):(0,i.jsx)(w,{contentItem:null==c?void 0:c.contentItemByTag,title:o,globalPlaceholders:k??[],placeholdersToShow:g,...m})},E=F;F.__docgenInfo={description:"",methods:[],displayName:"ContentItemEditor"}},"./src/shared/context/PlaceholdersContext.tsx":function(e,t,n){n.d(t,{h:()=>s,d:()=>o});var i=n("../node_modules/react/jsx-runtime.js"),a=n("../node_modules/@apollo/client/react/hooks/useQuery.js"),l=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js");let r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fetchPlaceholders"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"offerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placeholders"},arguments:[{kind:"Argument",name:{kind:"Name",value:"offerId"},value:{kind:"Variable",name:{kind:"Name",value:"offerId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tag"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]},[d,o]=(0,l.kr)({hookName:"usePlaceholdersState",providerName:"PlaceholdersProvider",isStrict:!1}),s=e=>{let{children:t,offerId:n}=e,{loading:l,data:o}=(0,a.aM)(r,{variables:{offerId:n},skip:!n});return(0,i.jsx)(d,{value:{isLoading:l,globalPlaceholders:(null==o?void 0:o.placeholders)||[]},children:t})};s.__docgenInfo={description:"Setting this provider is best done using the shared usePlaceholders hook.",methods:[],displayName:"PlaceholdersProvider"}}}]);