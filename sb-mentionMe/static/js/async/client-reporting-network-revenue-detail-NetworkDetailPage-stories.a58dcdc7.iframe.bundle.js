"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["5594"],{"./src/client/reporting/network-revenue/detail/NetworkDetailPage.stories.tsx":function(e,t,n){n.r(t),n.d(t,{Ok:()=>et,default:()=>ee});var a=n("../node_modules/react/jsx-runtime.js"),i=n("../node_modules/msw/lib/core/graphql.mjs"),r=n("../node_modules/msw/lib/core/HttpResponse.mjs"),o=n("./src/shared/context/MentionMeContext.tsx"),s=n("./src/client/advocacy/components/AdvocacyTemplate.tsx"),l=n("../node_modules/react/index.js"),d=n("../node_modules/@heroicons/react/24/outline/esm/LightBulbIcon.js"),c=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),m=n("../node_modules/react-i18next/dist/es/index.js"),u=n("../node_modules/react-router/esm/react-router.js"),k=n("./src/shared/@types/reporting.ts"),p=n("./src/client/reporting/network-revenue/components/NetworkChart/index.ts"),h=n("./src/client/reporting/network-revenue/components/NetworkMap/components/NetworkChartModal/index.ts"),g=n("./src/client/reporting/ecr/hooks/useMerchantData.ts"),w=n("./src/shared/assets/icon-academic-cap.svg"),v=n("./src/client/reporting/network-revenue/components/NetworkMap/components/NetworkTooltip/NetworkTooltip.styled.tsx");let N=e=>{let{header:t,hasIcon:n,colourTheme:i="light",subheader:r,type:o="info"}=e;return(0,a.jsx)(c.u,{colourTheme:i,tooltip:(0,a.jsxs)(v.DY,{children:[t&&(0,a.jsxs)(v.zJ,{children:[n&&(0,a.jsx)(w.Z,{}),(0,a.jsx)(c.S,{children:t})]}),r]}),children:"help"===o?(0,a.jsx)(v.by,{"data-auto-class":"help-icon"}):(0,a.jsx)(v.sz,{"data-auto-class":"info-icon"})})};N.__docgenInfo={description:"",methods:[],displayName:"NetworkTooltip",props:{header:{required:!1,tsType:{name:"string"},description:""},hasIcon:{required:!1,tsType:{name:"boolean"},description:""},subheader:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},type:{required:!1,tsType:{name:"union",raw:'"help" | "info"',elements:[{name:"literal",value:'"help"'},{name:"literal",value:'"info"'}]},description:"",defaultValue:{value:'"info"',computed:!1}},colourTheme:{defaultValue:{value:'"light"',computed:!1},required:!1}},composes:["Pick"]};var y=n("../node_modules/styled-components/dist/styled-components.browser.esm.js");(0,c.W0)(3);let x=y.ZP.div.withConfig({displayName:"NetworkDetailsMetadataMetric.styled__Metric"})(["display:flex;margin-top:",";"],(0,c.W0)(2)),f=(0,y.ZP)(c.S).withConfig({displayName:"NetworkDetailsMetadataMetric.styled__MetricHeading"})(["margin-bottom:",";"],(0,c.W0)(1)),j=y.ZP.span.withConfig({displayName:"NetworkDetailsMetadataMetric.styled__TooltipContainer"})(["margin-top:",";"],(0,c.W0)(.25)),b=(0,y.ZP)(c.L).withConfig({displayName:"NetworkDetailsMetadataMetric.styled__MetricValue"})(["font-weight:500;"]),_=y.ZP.span.withConfig({displayName:"NetworkDetailsMetadataMetric.styled__MetricCopy"})(["flex:1;"]),C=y.ZP.div.withConfig({displayName:"NetworkDetailsMetadataMetric.styled__Container"})(["display:flex;flex-wrap:nowrap;justify-content:left;align-items:flex-start;gap:",";"],(0,c.W0)(1)),D=e=>{let{heading:t,value:n,tooltipText:i}=e,{t:r}=(0,m.$G)("reporting",{keyPrefix:"network-insights.network-map.metadata"});return(0,a.jsx)(x,{children:(0,a.jsxs)(_,{children:[(0,a.jsxs)(C,{children:[(0,a.jsx)(f,{children:r(t)}),(0,a.jsx)(j,{children:(0,a.jsx)(N,{colourTheme:"dark",subheader:(0,a.jsx)(c.S,{children:r(i)})})})]}),(0,a.jsx)(b,{children:n})]})})};D.Skeleton=e=>{let{heading:t,width:n}=e,{t:i}=(0,m.$G)("reporting",{keyPrefix:"network-insights.network-map.metadata"});return(0,a.jsx)(x,{children:(0,a.jsxs)(_,{children:[(0,a.jsx)(f,{children:i(t)}),(0,a.jsx)(c.H5,{children:(0,a.jsx)(c.Od,{width:n})})]})})};D.__docgenInfo={description:"",methods:[{name:"Skeleton",docblock:null,modifiers:["static"],params:[{name:"{ heading, width }: SkeletonMetricProps",optional:!1,type:{name:"SkeletonMetricProps",alias:"SkeletonMetricProps"}}],returns:null}],displayName:"Metric",props:{heading:{required:!0,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"string"},description:""},tooltipText:{required:!0,tsType:{name:"string"},description:""}}};let M=y.ZP.div.withConfig((0,c.NZ)("columns","display")).withConfig({displayName:"NetworkDetailsMetadata.styled__Grid"})(["gap:",";",""],(0,c.W0)(3),e=>{let{display:t,columns:n}=e;return"column"===t?(0,y.iv)(["display:flex;flex-direction:column;gap:",";"],(0,c.W0)(1)):(0,y.iv)(["display:grid;grid-template-columns:repeat(",",1fr);gap:",";"],n,(0,c.W0)(3))}),S=e=>{let{display:t,network:n}=e,{t:i}=(0,m.$G)("reporting",{keyPrefix:"network-insights.network-map.metadata"}),{reportingCurrencyCode:r}=(0,g.Z)();if(n.loading)return(0,a.jsx)(S.Skeleton,{display:t});let o=[...n.canShowNetworkRevenueMetrics?[{heading:"network-revenue",value:(0,c.xG)(n.data.revenue||0,{fixedFractionDigits:0,currencyCode:r}),tooltipText:"tooltips.network-revenue"},{heading:"average-icr",value:(0,c.xG)(n.data.averageIndividualCustomerRevenue||0,{fixedFractionDigits:0,currencyCode:r}),tooltipText:"tooltips.average-icr"},{heading:"average-number-of-orders",value:`${(0,c.uf)(n.data.averageNumberOfOrders||0,{fixedFractionDigits:2})} ${i("per-customer")}`,tooltipText:"tooltips.average-orders"}]:[],{heading:"network-size",value:`${n.data.size} ${i("network-size-value",{count:n.data.size||0})}`,tooltipText:"tooltips.network-size"},{heading:"longest-chain",value:`${n.data.maxChainLength||0} ${i("longest-chain-value",{count:n.data.maxChainLength||0})}`,tooltipText:"tooltips.longest-referral-chain"}];return(0,a.jsx)(M,{display:t,columns:o.length,children:o.map(e=>(0,a.jsx)(D,{...e},e.heading))})},P=e=>{let{display:t}=e;return(0,a.jsx)(M,{display:t,columns:5,children:[{heading:"network-revenue",width:66},{heading:"average-icr",width:40},{heading:"average-number-of-orders",width:135},{heading:"network-size",width:80},{heading:"longest-chain",width:100}].map(e=>(0,a.jsx)(D.Skeleton,{...e},e.heading))})};S.Skeleton=P;P.__docgenInfo={description:"",methods:[],displayName:"NetworkDetailsMetadataSkeleton"},S.__docgenInfo={description:"",methods:[{name:"Skeleton",docblock:null,modifiers:["static"],params:[{name:'{ display }: Pick<NetworkDetailsMetadataProps, "display">',optional:!1,type:{name:"Pick",elements:[{name:"NetworkDetailsMetadataProps"},{name:"literal",value:'"display"'}],raw:'Pick<NetworkDetailsMetadataProps, "display">',alias:"Pick"}}],returns:null}],displayName:"NetworkDetailsMetadata",props:{display:{required:!0,tsType:{name:"union",raw:'"row" | "column"',elements:[{name:"literal",value:'"row"'},{name:"literal",value:'"column"'}]},description:""},network:{required:!0,tsType:{name:"ReturnType",elements:[{name:"useReferralNetwork"}],raw:"ReturnType<typeof useReferralNetwork>"},description:""}}};var T=n("./src/client/reporting/network-revenue/components/NetworkOverTimeChart/NetworkOverTimeChart.tsx"),F=n("./src/client/reporting/network-revenue/hooks/useReferralNetwork.ts"),I=n("./src/shared/@types/graphql.ts"),Z=n("./src/shared/components/index.ts"),R=n("./src/shared/hooks/index.ts"),V=n("./src/shared/hooks/usePostHog/index.ts"),E=n("../node_modules/@apollo/client/react/hooks/useMutation.js");let O={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RequestSegmentReportDownload"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"merchantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"networkId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"report_schedule"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"StringValue",value:"csv",block:!1}},{kind:"Argument",name:{kind:"Name",value:"reportType"},value:{kind:"StringValue",value:"BigQuery\\\\ReferralNetwork\\\\ReferralNetworkMemberList",block:!1}},{kind:"Argument",name:{kind:"Name",value:"merchantId"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}},{kind:"Argument",name:{kind:"Name",value:"shouldNotify"},value:{kind:"BooleanValue",value:!0}},{kind:"Argument",name:{kind:"Name",value:"reportFilters"},value:{kind:"ListValue",values:[{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"subFilters"},value:{kind:"ListValue",values:[{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"field"},value:{kind:"StringValue",value:"network_id",block:!1}},{kind:"ObjectField",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"networkId"}}}]}]}}]}]}},{kind:"Argument",name:{kind:"Name",value:"timePeriod"},value:{kind:"StringValue",value:"LAST-ALL-TIME",block:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var L=n("./src/shared/context/NotificationContext.tsx"),q=n("./src/user/hooks/useActiveUserState.ts");let A=e=>{let{t}=(0,m.$G)("reporting"),{addSuccessNotification:n,addErrorNotification:a}=(0,L.kE)(),{merchantId:i}=(0,R.rc)(),{data:r}=(0,q.Z)(),o=null==r?void 0:r.email,s=(0,l.useCallback)(()=>{a(t("shared:oops"),t("network-insights.network-customers.request-download.error.copy"))},[a,t]),d=(0,l.useCallback)(()=>{n(t("network-insights.network-customers.request-download.success.title"),t("network-insights.network-customers.request-download.success.copy",{userEmail:o,context:!o&&"NO-EMAIL"}))},[n,t,o]),[c,{loading:u,data:k}]=(0,E.D)(O);return{requestSegmentReportDownload:(0,l.useCallback)(()=>{c({variables:{merchantId:i,networkId:e},onError:s,onCompleted:d})},[c,i,e,s,d]),data:k,loading:u}},B=l.forwardRef(function({title:e,titleId:t,...n},a){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},n),e?l.createElement("title",{id:t},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"}))}),W=(0,y.ZP)(c.zx).withConfig({displayName:"DownloadNetworkButton.styled__Button"})(["height:fit-content;margin-left:auto;"]),$=(0,y.ZP)(B).withConfig({displayName:"DownloadNetworkButton.styled__LockClosedIcon"})(["fill:transparent !important;"]),H=e=>{let{isEmployeeOnly:t=!1}=e,{t:n}=(0,m.$G)("reporting"),{merchantId:i}=(0,R.rc)(),{postHog:r}=(0,V.U)(),{params:{networkId:o}}=(0,u.$B)(),{data:s,loading:l}=(0,F.Z)(o),{requestSegmentReportDownload:d}=A((null==s?void 0:s.id)||"");return l?(0,a.jsx)(c.Od,{width:220,height:32}):(0,a.jsxs)(W,{"data-ph":"network-insights-download-network-button",onClick:()=>{d(),t&&(null==r||r.capture("merchant-feature-bypass",{merchantId:i,feature:I.dn.NetworkInsightsDownload}))},disabled:l,children:[n("network-insights.network-map.download-network-button","Download customers in network"),t&&(0,a.jsx)($,{})]})},G=()=>(0,a.jsxs)(Z.eO,{feature:I.dn.NetworkInsightsDownload,children:[(0,a.jsx)(Z.eO.HasAccess,{children:(0,a.jsx)(H,{})}),(0,a.jsx)(Z.eO.InternalAccess,{hasTooltip:!0,children:(0,a.jsx)(H,{isEmployeeOnly:!0})})]});G.__docgenInfo={description:"",methods:[],displayName:"DownloadNetworkButton"};let z=(0,y.ZP)(c.H4).withConfig({displayName:"NetworkDetailPageContent.styled__Heading"})(["margin-bottom:",";"],(0,c.W0)(2)),K=y.ZP.div.withConfig({displayName:"NetworkDetailPageContent.styled__Container"})(["display:grid;gap:",";"],(0,c.W0)(4)),Q=y.ZP.div.withConfig({displayName:"NetworkDetailPageContent.styled__HeaderContainer"})(["display:flex;flex-wrap:nowrap;justify-content:space-between;align-items:center;"]),Y=y.ZP.ul.withConfig({displayName:"NetworkDetailPageContent.styled__List"})(["padding:"," 0 0 ",";"],(0,c.W0)(1),(0,c.W0)(2)),U=()=>{let{params:{networkId:e}}=(0,u.$B)(),{loading:t}=(0,F.Z)(e),{t:n}=(0,m.$G)("reporting",{keyPrefix:"network-insights.network-detail-map"});return(0,a.jsxs)(Q,{children:[(0,a.jsx)(c.H2,{children:t?(0,a.jsx)(c.Od,{width:200}):(0,a.jsxs)(a.Fragment,{children:[n("title","Network "),e]})}),(0,a.jsx)(G,{})]})},J=()=>{var e;let t=(0,c.OT)(),{params:{networkId:n}}=(0,u.$B)(),i=(0,F.Z)(n),{t:r}=(0,m.$G)("reporting",{keyPrefix:"network-insights.network-detail-map"}),o=(0,l.useMemo)(()=>{var e;if(!(null==i?void 0:null===(e=i.data)||void 0===e?void 0:e.startDate))return k.Cc.WEEK;let t=new Date(i.data.startDate),n=new Date;return n.setFullYear(n.getFullYear()-1),t<=n?k.Cc.MONTH:k.Cc.WEEK},[null==i?void 0:null===(e=i.data)||void 0===e?void 0:e.startDate]);return(0,a.jsxs)(K,{children:[(0,a.jsx)(U,{}),(0,a.jsxs)(c.eg,{variant:"dark",isFullWidth:!0,children:[(0,a.jsx)(c.eg.Icon,{children:(0,a.jsx)(d.Z,{})}),(0,a.jsx)(c.eg.Body,{children:(0,a.jsxs)(m.cC,{i18nKey:"information-box.body",children:[(0,a.jsx)(c.H5,{children:"Make the most of this data"}),(0,a.jsxs)(Y,{children:[(0,a.jsx)("li",{children:"Download them to your CRM and analyse what else might link them together"}),(0,a.jsx)("li",{children:"Compare and contrast the different details about this network and see what makes for a great network"})]})]})})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(p.Z,{networkData:i.data,isLoading:i.loading,modal:t}),(0,a.jsx)(h.m,{modal:t,selectedNetwork:i})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(z,{children:r("characteristics.title","Network Characteristics")}),(0,a.jsx)(c.M,{children:r("characteristics.body","Main characteristics of this network and how each metric ranks across all networks")}),(0,a.jsx)(S,{display:"row",network:i})]}),!(null==i?void 0:i.loading)&&(null==i?void 0:i.canShowNetworkRevenueMetrics)&&(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(z,{children:r("network-over-time-chart.header","How this network has evolved over time")}),(0,a.jsx)(c.M,{children:r("network-over-time-chart.subheader","How network revenue has grown over time, and where new customers have joined")}),(0,a.jsx)(T.Z,{networkId:n,groupBy:o})]})]})};J.__docgenInfo={description:"",methods:[],displayName:"NetworkDetailPageContent"};let X=()=>(0,a.jsx)(s.Z,{children:(0,a.jsx)(J,{})});X.__docgenInfo={description:"",methods:[],displayName:"NetworkDetailPage"};let ee={component:X,title:"Portal / Reporting / Network Insights / Network Detail Page",decorators:[e=>(0,a.jsx)("div",{style:{maxWidth:"1200px"},children:e()})],parameters:{chromatic:{disableSnapshot:!0},msw:{handlers:[i.B.query("merchant",()=>r.Z.json({data:{__typename:"Query",merchant:{__typename:"Merchant",id:"4296",reportingCurrencySymbol:"\xa3"}}}))]}}},et=e=>(0,a.jsx)(o.Z,{children:(0,a.jsx)(X,{...e})});et.args={},et.parameters={},et.parameters={...et.parameters,docs:{...et.parameters?.docs,source:{originalSource:"args => {\n  return <MentionMeProvider>\n            <NetworkInsightsPage {...args} />\n        </MentionMeProvider>;\n}",...et.parameters?.docs?.source}}}},"./src/client/reporting/hooks/useCampaigns.ts":function(e,t,n){n.d(t,{Z:()=>d});var a=n("../node_modules/react/index.js"),i=n("../node_modules/@apollo/client/react/hooks/useQuery.js"),r=n("./src/shared/@types/graphql.ts"),o=n("./src/shared/constants/filterStatuses.ts"),s=n("./src/shared/hooks/index.ts");let l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fetchFilterableCampaigns"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"merchantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"campaignFilterBy"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FilterInput"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"merchant"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"campaigns"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filterBy"},value:{kind:"Variable",name:{kind:"Name",value:"campaignFilterBy"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"shortName"}},{kind:"Field",name:{kind:"Name",value:"hasEverRunReferral"}},{kind:"Field",name:{kind:"Name",value:"hasEverRunIFA"}},{kind:"Field",name:{kind:"Name",value:"hasEverRunNPS"}},{kind:"Field",name:{kind:"Name",value:"hasRunningNPSExperiments"}},{kind:"Field",name:{kind:"Name",value:"hasEverSupportedNativeShareWithMessageCapture"}},{kind:"Field",name:{kind:"Name",value:"dateLastLiveWithNPS"}},{kind:"Field",name:{kind:"Name",value:"status"}}]}}]}}]}}]}}]},d=e=>{let{campaignTypes:t,excludedCampaignStatuses:n=[o.Z.DRAFT,o.Z.ARCHIVED],onCompleted:d}=e,{merchantId:c}=(0,s.rc)(),m=(0,a.useCallback)(e=>{var n;return((null==e?void 0:null===(n=e.merchant)||void 0===n?void 0:n.campaigns.edges)||[]).filter(e=>{let{hasEverRunNPS:n,hasEverRunIFA:a,hasEverRunReferral:i}=e;if(!t)return!0;let r=!0;return t.forEach(e=>{switch(e){case"REFERRAL":r=i;break;case"IFA":r=a;break;case"NPS":r=n;break;default:r=!1}}),r})},[t]),{data:u,loading:k}=(0,i.aM)(l,{variables:{merchantId:c,campaignFilterBy:[{field:"Status",operator:r.Nc.NotIn,value:n}]},onCompleted:e=>{null==d||d(m(e))}});return{loading:k,campaigns:m(u)}}},"../node_modules/@heroicons/react/24/solid/esm/StarIcon.js":function(e,t,n){n.d(t,{Z:function(){return i}});var a=n("../node_modules/react/index.js");let i=a.forwardRef(function({title:e,titleId:t,...n},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,a.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z",clipRule:"evenodd"}))})}}]);