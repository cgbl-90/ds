"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["9279"],{"./src/client/tools/DebugDashboard/components/IntegrationLogStatusBanner.stories.tsx":function(e,r,t){t.r(r),t.d(r,{Loading:()=>v,TechOpsVersion:()=>L,default:()=>M,Default:()=>T});var n=t("../node_modules/react/jsx-runtime.js"),s=t("../node_modules/msw/lib/core/graphql.mjs"),i=t("../node_modules/msw/lib/core/HttpResponse.mjs"),o=t("../node_modules/is-node-process/lib/index.mjs");function a(){return(0,o.l)()?5:Math.floor(300*Math.random()+100)}async function l(e){let r;if("string"==typeof e)switch(e){case"infinite":r=0x7fffffff;break;case"real":r=a();break;default:throw Error(`Failed to delay a response: unknown delay mode "${e}". Please make sure you provide one of the supported modes ("real", "infinite") or a number.`)}else if(void 0===e)r=a();else{if(e>0x7fffffff)throw Error(`Failed to delay a response: provided delay duration (${e}) exceeds the maximum allowed duration for "setTimeout" (2147483647). This will cause the response to be returned immediately. Please use a number within the allowed range to delay the response by exact duration, or consider the "infinite" delay mode to delay the response indefinitely.`);r=e}return new Promise(e=>setTimeout(e,r))}var d=t("./src/client/tools/DebugDashboard/context/DebugDashboardContext.tsx");let u={__typename:"Query",integrationLogAggregations:{__typename:"IntegrationLogAggregation",hasErrors:1,hasWarnings:2,isDuplicateOrder:3,areCorrect:4}},c={__typename:"Query",integrationLogs:{edges:[],pageInfo:{offset:0,limit:10,totalCount:26781,totalPages:2679,currentPage:1,hasNextPage:!0,__typename:"PaginationInfo"},__typename:"IntegrationLogConnection"}},p={__typename:"Query",user:{__typename:"User",id:"abc123",firstname:"John",surname:"Doe",email:"john.doe@example.com",roles:["ROLE_MERCHANT_CS"],isEmployee:!1,isImpersonating:!1,featureSwitches:[]}},m=Object.assign(p,{user:{roles:["ROLE_MM_TECH_OPS"]}});var _=t("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),h=t("../node_modules/react-i18next/dist/es/index.js"),g=t("./src/shared/utilities/IsGranted/index.ts"),E=t("./src/user/types/RoleType.ts"),R=t("../node_modules/styled-components/dist/styled-components.browser.esm.js");let f=R.ZP.div.withConfig({displayName:"IntegrationLogStatusBanner.styled__Container"})(["display:flex;gap:",";justify-content:space-between;"],(0,_.W0)(2)),y=R.ZP.div.withConfig({displayName:"IntegrationLogStatusBanner.styled__LabelsContainer"})(["display:flex;gap:",";align-items:center;"],(0,_.W0)(2)),N=R.ZP.div.withConfig({displayName:"IntegrationLogStatusBanner.styled__ClickableDiv"})(["cursor:pointer;"]),S=()=>{let{t:e}=(0,h.$G)("tools",{keyPrefix:"debug-dashboard.search-results"}),{loading:r,aggregations:t,pagination:s,updateQueryVariable:i,toggleFilter:o,shouldShowStats:a,setShouldShowStats:l}=(0,d.F7)(),{isDuplicateOrder:u,hasWarnings:c,hasErrors:p}=t||{};return(0,n.jsxs)(f,{children:[(0,n.jsx)(_.H4,{children:e("title","Results")}),(0,n.jsxs)(y,{children:[(0,n.jsx)(_.zx,{variant:"transparent",onClick:()=>{l(e=>!e)},children:a?e("stats.close","Close stats"):e("stats.open","Show more stats")}),(0,n.jsxs)("div",{children:[(0,n.jsx)(_.__,{variant:"classification",children:e("found","Found")}),(0,n.jsx)(_.__,{variant:"numerical-context",rating:"good",loading:r,children:s.totalCount})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(_.__,{variant:"classification",children:e("valid","Valid")}),(0,n.jsx)(_.__,{variant:"numerical-context",rating:"good",loading:r,children:(null==t?void 0:t.areCorrect)||0})]}),(0,n.jsx)(g.ZP.Role,{requiredRole:E.Z.ROLE_MM_TECH_OPS,children:(0,n.jsxs)(N,{role:"button",onClick:()=>{i("isDuplicateOrder",!0),o("isDuplicateOrder")},children:[(0,n.jsx)(_.__,{variant:"classification",children:e("duplicate","Duplicate orders")}),(0,n.jsx)(_.__,{variant:"numerical-context",rating:u&&u>0?"average":"good",loading:r,children:(null==t?void 0:t.isDuplicateOrder)||0})]})}),(0,n.jsxs)(N,{role:"button",onClick:()=>{i("hasWarnings",!0),o("hasWarnings")},children:[(0,n.jsx)(_.__,{variant:"classification",children:e("warnings","Warnings")}),(0,n.jsx)(_.__,{variant:"numerical-context",rating:c&&c>0?"average":"good",loading:r,children:(null==t?void 0:t.hasWarnings)||0})]}),(0,n.jsxs)(N,{role:"button",onClick:()=>{i("hasErrors",!0),o("hasErrors")},children:[(0,n.jsx)(_.__,{variant:"classification",children:e("errors","Errors")}),(0,n.jsx)(_.__,{variant:"numerical-context",rating:p&&p>0?"bad":"good",loading:r,children:(null==t?void 0:t.hasErrors)||0})]})]})]})};S.__docgenInfo={description:"",methods:[],displayName:"IntegrationLogStatusBanner"};let M={title:"Portal / Tools / DebugDashboard / IntegrationLogStatusBanner",component:S,parameters:{layout:"padded",msw:{handlers:[s.B.query("fetchIntegrationLogs",()=>i.Z.json({data:c})),s.B.query("fetchIntegrationLogAggregations",()=>i.Z.json({data:u})),s.B.query("user",()=>i.Z.json({data:p}))]}}},O=()=>(0,n.jsx)(d.Qq,{children:(0,n.jsx)(S,{})}),T=O.bind({}),v=O.bind({});v.parameters={msw:{handlers:[s.B.query("fetchIntegrationLogs",async()=>{await l("infinite")}),s.B.query("fetchIntegrationLogAggregations",async()=>{await l("infinite")}),s.B.query("user",async()=>{await l("infinite")})]}};let L=O.bind({});L.parameters={msw:{handlers:[s.B.query("fetchIntegrationLogs",()=>i.Z.json({data:c})),s.B.query("fetchIntegrationLogAggregations",()=>i.Z.json({data:u})),s.B.query("user",()=>i.Z.json({data:m}))]}},T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:"() => <DebugDashboardProvider>\n        <IntegrationLogStatusBanner />\n    </DebugDashboardProvider>",...T.parameters?.docs?.source}}},v.parameters={...v.parameters,docs:{...v.parameters?.docs,source:{originalSource:"() => <DebugDashboardProvider>\n        <IntegrationLogStatusBanner />\n    </DebugDashboardProvider>",...v.parameters?.docs?.source}}},L.parameters={...L.parameters,docs:{...L.parameters?.docs,source:{originalSource:"() => <DebugDashboardProvider>\n        <IntegrationLogStatusBanner />\n    </DebugDashboardProvider>",...L.parameters?.docs?.source}}}},"./src/shared/utilities/IsGranted/IsGranted.tsx":function(e,r,t){t.d(r,{Z:()=>l});var n=t("./src/shared/utilities/IsGranted/Permission.tsx"),s=t("../node_modules/react/jsx-runtime.js"),i=t("./src/user/hooks/useActiveUserState.ts"),o=t("./src/shared/utilities/checkHasRole.ts");let a=e=>{let{requiredRole:r,children:t}=e,{isLoading:n,data:a}=(0,i.Z)(),l=Array.isArray(r)?r:[r];return n||!(0,o.Z)(l,(null==a?void 0:a.roles)||[])?null:(0,s.jsx)(s.Fragment,{children:t})};a.__docgenInfo={description:"This component should be used via <IsGranted.Role ...>",methods:[],displayName:"Role"};let l={Role:a,Permission:n.ZP}},"./src/shared/utilities/IsGranted/Permission.tsx":function(e,r,t){t.d(r,{ZP:function(){return a},r3:function(){return i}});var n=t("../node_modules/react/jsx-runtime.js"),s=t("./src/user/hooks/usePermissionState.ts");let i={BETA_USER:"permission.beta_user",CAMPAIGN:"permission.campaign",CLIENT_ACCOUNT_VIEW:"permission.client_account.view",CUSTOMERS:"permission.customers",DASHBOARD:"permission.dashboard",DESIGNS:"permission.designs",INTEGRATION:"permission.integration",MERCHANT_CUSTOMER_EDIT:"permission.merchant.customers.edit",MERCHANT_DEMO_VIEW:"permission.merchant.demo.view",MERCHANT_EDIT:"permission.merchant.edit",MERCHANT_HISTORICAL_CUSTOMERS:"permission.merchant.historical-customers",MERCHANT_SECURE_FILE_TRANSFER:"permission.merchant.secure-file-transfer",PREVIEW:"permission.preview",REPORT:"permission.report",REWARDS:"permission.rewards",SETUP:"permission.setup",USER_2FA_SETUP_AUTHENTICATION:"permission.user.2fa.setup-authentication",USER_2FA_SETUP_RECOVERY:"permission.user.2fa.setup-recovery",USER_2FA_VALIDATE:"permission.user.2fa.validate",USER_EDIT:"permission.user.edit",USER_IMPERSONATE:"permission.user.impersonate",USER_LINK_TO_MERCHANT:"permission.user.link-to-admin",USER_RESET_2FA:"permission.user.reset-2fa"},o=e=>{let{requiredPermission:r,entityType:t,entityId:i,children:o}=e,{isLoading:a,data:l}=(0,s.Z)(r,t,i);return!a&&(null==l?void 0:l.granted)?(0,n.jsx)(n.Fragment,{children:o}):null},a=o;o.__docgenInfo={description:"This component should be used via <IsGranted.Permission ...>",methods:[],displayName:"Permission"}},"./src/shared/utilities/IsGranted/index.ts":function(e,r,t){t.d(r,{ZP:function(){return i},r3:function(){return s.r3}});var n=t("./src/shared/utilities/IsGranted/IsGranted.tsx"),s=t("./src/shared/utilities/IsGranted/Permission.tsx");let i=n.Z},"./src/user/hooks/usePermissionState.ts":function(e,r,t){t.d(r,{Z:()=>i});var n=t("../node_modules/@apollo/client/react/hooks/useQuery.js");let s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"permissions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"check"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PermissionInput"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"permissions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"check"},value:{kind:"Variable",name:{kind:"Name",value:"check"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"granted"}}]}}]}}]},i=(e,r,t)=>{var i;let{data:o,loading:a}=(0,n.aM)(s,{variables:{check:[{permission:e,entityType:r,entityId:String(t)}]},skip:!e});return{isLoading:a,data:null==o?void 0:null===(i=o.permissions)||void 0===i?void 0:i[0]}}},"./src/user/types/RoleType.ts":function(e,r,t){t.d(r,{Z:function(){return n}});let n={ROLE_MERCHANT_PERFORMANCE:"ROLE_MERCHANT_PERFORMANCE",ROLE_MERCHANT:"ROLE_MERCHANT",ROLE_MERCHANT_CS:"ROLE_MERCHANT_CS",ROLE_MERCHANT_CS_SUPERVISOR:"ROLE_MERCHANT_CS_SUPERVISOR",ROLE_MERCHANT_CS_NO_APPROVAL:"ROLE_MERCHANT_CS_NO_APPROVAL",ROLE_MERCHANT_ADMIN:"ROLE_MERCHANT_ADMIN",ROLE_MERCHANT_DESIGNER:"ROLE_MERCHANT_DESIGNER",ROLE_MERCHANT_DEMO_VIEWER:"ROLE_MERCHANT_DEMO_VIEWER",IS_IMPERSONATOR:"IS_IMPERSONATOR",ROLE_MM_EMPLOYEE:"ROLE_MM_EMPLOYEE",ROLE_MM_SALES:"ROLE_MM_SALES",ROLE_MM_SALES_LIVE:"ROLE_MM_SALES_LIVE",ROLE_MM_MARKETING:"ROLE_MM_MARKETING",ROLE_MM_CSM:"ROLE_MM_CSM",ROLE_MM_TECH_OPS:"ROLE_MM_TECH_OPS",ROLE_MM_GDPR_ACTIONS:"ROLE_MM_GDPR_ACTIONS",ROLE_MM_SENIOR_OPERATIONS:"ROLE_MM_SENIOR_OPERATIONS",ROLE_MM_CSM_SENIOR_CROSS_MERCHANT_REPORTING:"ROLE_MM_CSM_SENIOR_CROSS_MERCHANT_REPORTING",ROLE_MM_ENGINEERING:"ROLE_MM_ENGINEERING",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN"}},"../node_modules/msw/lib/core/graphql.mjs":function(e,r,t){t.d(r,{B:()=>S});var n=t("../node_modules/msw/lib/core/handlers/RequestHandler.mjs"),s=t("../node_modules/msw/lib/core/utils/logging/getTimestamp.mjs"),i=t("../node_modules/msw/lib/core/utils/logging/getStatusCodeColor.mjs"),o=t("../node_modules/msw/lib/core/utils/logging/serializeRequest.mjs"),a=t("../node_modules/msw/lib/core/utils/logging/serializeResponse.mjs"),l=t("../node_modules/msw/lib/core/utils/matching/matchRequestUrl.mjs"),d=t("../node_modules/msw/lib/core/utils/request/toPublicUrl.mjs"),u=t("../node_modules/msw/lib/core/utils/internal/devUtils.mjs");function c(e){try{return JSON.parse(e)}catch{return}}var p=t("../node_modules/headers-polyfill/lib/index.mjs");function m(e){let r=e.definitions.find(e=>"OperationDefinition"===e.kind);return{operationType:r?.operation,operationName:r?.name?.value}}async function _(e){let{parse:r}=await t.e("8055").then(t.bind(t,"../node_modules/msw/node_modules/graphql/index.mjs")).catch(e=>{throw console.error('[MSW] Failed to parse a GraphQL query: cannot import the "graphql" module. Please make sure you install it if you wish to intercept GraphQL requests. See the original import error below.'),e});try{let t=r(e);return m(t)}catch(e){return e}}async function h(e){switch(e.method){case"GET":{let r=new URL(e.url),t=r.searchParams.get("query");return{query:t,variables:c(r.searchParams.get("variables")||"")}}case"POST":{let r=e.clone();if(e.headers.get("content-type")?.includes("multipart/form-data")){let t=function(e,r){let t=r?.get("content-type");if(!t)return;let[,...n]=t.split(/; */),s=n.filter(e=>e.startsWith("boundary=")).map(e=>e.replace(/^boundary=/,""))[0];if(!s)return;let i=RegExp(`--+${s}`),o=e.split(i).filter(e=>e.startsWith("\r\n")&&e.endsWith("\r\n")).map(e=>e.trimStart().replace(/\r\n$/,""));if(!o.length)return;let a={};try{for(let e of o){let[r,...t]=e.split("\r\n\r\n"),n=t.join("\r\n\r\n"),{contentType:s,filename:i,name:o}=function(e){let r=(0,p.$M)(e),t=r.get("content-type")||"text/plain",n=r.get("content-disposition");if(!n)throw Error('"Content-Disposition" header is required.');let s=n.split(";").reduce((e,r)=>{let[t,...n]=r.trim().split("=");return e[t]=n.join("="),e},{}),i=s.name?.slice(1,-1);return{name:i,filename:s.filename?.slice(1,-1),contentType:t}}(r),l=void 0===i?n:new File([n],i,{type:s}),d=a[o];void 0===d?a[o]=l:Array.isArray(d)?a[o]=[...d,l]:a[o]=[d,l]}return a}catch{return}}(await r.text(),e.headers);if(!t)return null;let{operations:n,map:s,...i}=t,o=c(n)||{};if(!o.query)return null;let a=c(s||"")||{},l=o.variables?function(e,r,t){let n={variables:e};for(let[e,s]of Object.entries(r)){if(!(e in t))throw Error(`Given files do not have a key '${e}' .`);for(let r of s){let[s,...i]=r.split(".").reverse(),o=i.reverse(),a=n;for(let e of o){if(!(e in a))throw Error(`Property '${o}' is not in operations.`);a=a[e]}a[s]=t[e]}}return n.variables}(o.variables,a,i):{};return{query:o.query,variables:l}}let t=await r.json().catch(()=>null);if(t?.query){let{query:e,variables:r}=t;return{query:e,variables:r}}}default:return null}}async function g(e){let r=await h(e);if(!r||!r.query)return;let{query:t,variables:n}=r,s=await _(t);if(s instanceof Error){let r=(0,d.F)(e.url);throw Error(u.e.formatMessage('Failed to intercept a GraphQL request to "%s %s": cannot parse query. See the error message from the parser below.\n\n%s',e.method,r,s.message))}return{query:r.query,operationType:s.operationType,operationName:s.operationName,variables:n}}var E=t("../node_modules/msw/lib/core/utils/request/getRequestCookies.mjs");class R extends n.Z{endpoint;static parsedRequestCache=new WeakMap;constructor(e,r,t,n,s){var i;let o=r;if(null!=(i=r)&&"object"==typeof i&&"kind"in i&&"definitions"in i){let t=m(r);if(t.operationType!==e)throw Error(`Failed to create a GraphQL handler: provided a DocumentNode with a mismatched operation type (expected "${e}", but got "${t.operationType}").`);if(!t.operationName)throw Error("Failed to create a GraphQL handler: provided a DocumentNode with no operation name.");o=t.operationName}super({info:{header:"all"===e?`${e} (origin: ${t.toString()})`:`${e} ${o} (origin: ${t.toString()})`,operationType:e,operationName:o},resolver:n,options:s}),this.endpoint=t}async parseGraphQLRequestOrGetFromCache(e){return!R.parsedRequestCache.has(e)&&R.parsedRequestCache.set(e,await g(e).catch(e=>{console.error(e)})),R.parsedRequestCache.get(e)}async parse(e){let r=(0,l.R)(new URL(e.request.url),this.endpoint),t=(0,E.B)(e.request);if(!r.matches)return{match:r,cookies:t};let n=await this.parseGraphQLRequestOrGetFromCache(e.request);return void 0===n?{match:r,cookies:t}:{match:r,cookies:t,query:n.query,operationType:n.operationType,operationName:n.operationName,variables:n.variables}}predicate(e){if(void 0===e.parsedResult.operationType)return!1;if(!e.parsedResult.operationName&&"all"!==this.info.operationType){let r=(0,d.F)(e.request.url);return u.e.warn(`Failed to intercept a GraphQL request at "${e.request.method} ${r}": anonymous GraphQL operations are not supported.

Consider naming this operation or using "graphql.operation()" request handler to intercept GraphQL requests regardless of their operation name/type. Read more: https://mswjs.io/docs/api/graphql/#graphqloperationresolver`),!1}let r="all"===this.info.operationType||e.parsedResult.operationType===this.info.operationType,t=this.info.operationName instanceof RegExp?this.info.operationName.test(e.parsedResult.operationName||""):e.parsedResult.operationName===this.info.operationName;return e.parsedResult.match.matches&&r&&t}extendResolverArgs(e){return{query:e.parsedResult.query||"",operationName:e.parsedResult.operationName||"",variables:e.parsedResult.variables||{},cookies:e.parsedResult.cookies}}async log(e){let r=await (0,o.Y)(e.request),t=await (0,a.X)(e.response),n=(0,i.m)(t.status),l=e.parsedResult.operationName?`${e.parsedResult.operationType} ${e.parsedResult.operationName}`:`anonymous ${e.parsedResult.operationType}`;console.groupCollapsed(u.e.formatMessage(`${(0,s.u)()} ${l} (%c${t.status} ${t.statusText}%c)`),`color:${n}`,"color:inherit"),console.log("Request:",r),console.log("Handler:",this),console.log("Response:",t),console.groupEnd()}}function f(e,r){return(t,n,s={})=>new R(e,t,r,n,s)}function y(e){return r=>new R("all",RegExp(".*"),e,r)}let N={query:f("query","*"),mutation:f("mutation","*"),operation:y("*")},S={...N,link:function(e){return{operation:y(e),query:f("query",e),mutation:f("mutation",e)}}}}}]);
//# sourceMappingURL=client-tools-DebugDashboard-components-IntegrationLogStatusBanner-stories.3e6c311e.iframe.bundle.js.map