"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["2773"],{"./src/client/customer/approvals/hooks/useSingleApprovalMutation.ts":function(e,a,n){n.d(a,{Z:()=>m});var i=n("../node_modules/react/index.js"),t=n("../node_modules/@apollo/client/react/hooks/useMutation.js"),r=n("../node_modules/react-i18next/dist/es/index.js"),l=n("./src/shared/context/NotificationContext.tsx"),s=n("./src/shared/hooks/index.ts"),o=n("./src/client/customer/utilities/getApprovalId.ts");let d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"approveApprovable"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ApprovableObjectEnum"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"merchantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"bypassVelocityChecks"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"approve_Approvable"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"Argument",name:{kind:"Name",value:"merchantId"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}},{kind:"Argument",name:{kind:"Name",value:"bypassVelocityChecks"},value:{kind:"Variable",name:{kind:"Name",value:"bypassVelocityChecks"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isPendingApproval"}},{kind:"Field",name:{kind:"Name",value:"isSuspectedOfGaming"}},{kind:"Field",name:{kind:"Name",value:"approvalReason"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Referrer"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"willTriggerGamingIfApproved"}}]}}]}}]}}]},p=e=>"willTriggerGamingIfApproved"in e,m=(e,a)=>{let{t:n}=(0,r.$G)("customer"),{merchantId:m}=(0,s.rc)(),{addSuccessNotification:u,addErrorNotification:c}=(0,l.kE)(),[v,{loading:y}]=(0,t.D)(d,{onCompleted:e=>{p(e.approve_Approvable[0])&&e.approve_Approvable[0].willTriggerGamingIfApproved?c(n("toast.single.approve.gaming.title","Customer not approved"),n("toast.single.approve.gaming.content","The selected customer has not been approved as approving them will trigger gaming rules. Please confirm if you'd like to approve.")):u(n("toast.single.approve.title","Customer approved"),n("toast.single.approve.content","The selected customer has been approved."))},onError:()=>{c(n("shared:oops","Oops!"),n("toast.bulk.approve.error","There was an error approving."))}});return{loading:y,approvalCallback:(0,i.useCallback)(n=>{v({variables:{merchantId:m,objectType:e,ids:[(0,o.Z)(n)],bypassVelocityChecks:a}})},[m,e,a,v])}}},"./src/client/customer/components/ApprovalReason.tsx":function(e,a,n){n.d(a,{Z:()=>m});var i=n("../node_modules/react/jsx-runtime.js"),t=n("../node_modules/react-i18next/dist/es/index.js"),r=n("./src/shared/components/DateFormat/index.ts");let l=e=>{let{approvable:a}=e,{t:n}=(0,t.$G)("customer");return(0,i.jsxs)(t.cC,{t:n,i18nKey:"reward.delay",children:["This reward has a delay. ",(0,i.jsx)("br",{}),"It will automatically be given"," ",(0,i.jsx)("strong",{children:(0,i.jsx)(r.Z,{date:a.delayWillPassAt,variant:"fromNow"})}),"."]})};l.__docgenInfo={description:"",methods:[],displayName:"ApprovalReasonDelay",props:{approvable:{required:!0,tsType:{name:"Pick",elements:[{name:"Approvable"},{name:"literal",value:'"delayWillPassAt"'}],raw:'Pick<Approvable, "delayWillPassAt">'},description:""}}};let s=n("../node_modules/styled-components/dist/styled-components.browser.esm.js").ZP.ul.withConfig({displayName:"ApprovalReasonGaming.styled__ApprovalReasonList"})(["padding:0;margin:0;list-style:none;"]),o=e=>{let{approvable:a}=e,{t:n}=(0,t.$G)("customer");return(0,i.jsx)(s,{children:((null==a?void 0:a.approvalReason)??[]).map(e=>(0,i.jsx)("li",{children:n(e.key,{value:e.value})},e.key))})};o.__docgenInfo={description:"",methods:[],displayName:"ApprovalReasonGaming",props:{approvable:{required:!0,tsType:{name:"Pick",elements:[{name:"Approvable"},{name:"literal",value:'"approvalReason"'}],raw:'Pick<Approvable, "approvalReason">'},description:""}}};let d=e=>{let{approvable:a}=e,{t:n}=(0,t.$G)("customer");return a.approvalReason&&a.approvalReason.length>0?(0,i.jsx)(s,{children:((null==a?void 0:a.approvalReason)??[]).map(e=>(0,i.jsx)("li",{children:n(e.key,{value:e.value})},e.key))}):(0,i.jsx)(i.Fragment,{children:n("reward.approval","This reward requires approval")})};d.__docgenInfo={description:"",methods:[],displayName:"ApprovalReasonManual",props:{approvable:{required:!0,tsType:{name:"Pick",elements:[{name:"Approvable"},{name:"literal",value:'"approvalReason"'}],raw:'Pick<Approvable, "approvalReason">'},description:""}}};let p=e=>{let{approvable:a}=e;return a.isSuspectedOfGaming?(0,i.jsx)(o,{approvable:a}):a.delayWillPassAt?(0,i.jsx)(l,{approvable:a}):(0,i.jsx)(d,{approvable:a})},m=p;p.__docgenInfo={description:"",methods:[],displayName:"ApprovalReason",props:{approvable:{required:!0,tsType:{name:"Pick",elements:[{name:"Approvable"},{name:"union",raw:'"approvalReason" | "delayWillPassAt" | "isSuspectedOfGaming"',elements:[{name:"literal",value:'"approvalReason"'},{name:"literal",value:'"delayWillPassAt"'},{name:"literal",value:'"isSuspectedOfGaming"'}]}],raw:'Pick<Approvable, "approvalReason" | "delayWillPassAt" | "isSuspectedOfGaming">'},description:""}}}},"./src/client/customer/profile/components/CustomerProfileActivity/components/ActivityFeedItems/components/ActivityStatusLabels/ApprovableEventLabels.tsx":function(e,a,n){n.d(a,{Z:()=>_});var i=n("../node_modules/react/jsx-runtime.js"),t=n("../node_modules/react/index.js"),r=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),l=n("../node_modules/react-i18next/dist/es/index.js"),s=n("./src/shared/components/index.ts"),o=n("./src/shared/components/DateFormat/index.ts"),d=n("./src/client/customer/components/ApprovalReason.tsx"),p=n("./src/shared/utilities/IsGranted/index.ts"),m=n("./src/user/types/RoleType.ts"),u=n("./src/client/customer/approvals/hooks/useSingleApprovalMutation.ts");let c=e=>{let{approvable:a,objectType:n,helpMessage:t}=e,{t:o}=(0,l.$G)("customer"),{approvalCallback:d,loading:c}=(0,u.Z)(n,!0);return(0,i.jsxs)(p.ZP.Role,{requiredRole:m.Z.ROLE_MERCHANT_CS,children:[(0,i.jsx)(r.zx,{variant:"link",onClick:()=>{d(a)},isLoading:c,spinnerLocation:"right",loadingText:o("approval.actions.loading.approve","Approving..."),children:o("approval.action.approve_anyway","Approve")}),(0,i.jsx)(s.WW,{message:t})]})};c.__docgenInfo={description:"",methods:[],displayName:"ApproveAnywayButton",props:{approvable:{required:!0,tsType:{name:"intersection",raw:'Pick<\n    Approvable,\n    | "id"\n    | "isPendingApproval"\n    | "isSuspectedOfGaming"\n    | "approvedDate"\n    | "declinedDate"\n    | "cancelledDate"\n    | "gamingScore"\n    | "approvalReason"\n> & {\n    authorisedByUser?: Maybe<Pick<User, "id" | "firstname" | "surname" | "email">>;\n}',elements:[{name:"Pick",elements:[{name:"Approvable"},{name:"union",raw:'| "id"\n| "isPendingApproval"\n| "isSuspectedOfGaming"\n| "approvedDate"\n| "declinedDate"\n| "cancelledDate"\n| "gamingScore"\n| "approvalReason"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"isPendingApproval"'},{name:"literal",value:'"isSuspectedOfGaming"'},{name:"literal",value:'"approvedDate"'},{name:"literal",value:'"declinedDate"'},{name:"literal",value:'"cancelledDate"'},{name:"literal",value:'"gamingScore"'},{name:"literal",value:'"approvalReason"'}]}],raw:'Pick<\n    Approvable,\n    | "id"\n    | "isPendingApproval"\n    | "isSuspectedOfGaming"\n    | "approvedDate"\n    | "declinedDate"\n    | "cancelledDate"\n    | "gamingScore"\n    | "approvalReason"\n>'},{name:"signature",type:"object",raw:'{\n    authorisedByUser?: Maybe<Pick<User, "id" | "firstname" | "surname" | "email">>;\n}',signature:{properties:[{key:"authorisedByUser",value:{name:"union",raw:"T | null",elements:[{name:"Pick",elements:[{name:"User"},{name:"union",raw:'"id" | "firstname" | "surname" | "email"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"firstname"'},{name:"literal",value:'"surname"'},{name:"literal",value:'"email"'}]}],raw:'Pick<User, "id" | "firstname" | "surname" | "email">'},{name:"null"}],required:!1}}]}}]},description:""},objectType:{required:!0,tsType:{name:"ApprovableObjectEnum"},description:""},helpMessage:{required:!0,tsType:{name:"string"},description:""}}};let v=e=>{let{referee:{matchedViaMethod:a,authorisedByUser:n}}=e,{t:r}=(0,l.$G)("customer"),s=(0,t.useMemo)(()=>n?null:(null==a?void 0:a.includes("EXISTING-CUSTOMER"))?r("cancellation.reason.existing","The customer is already an existing customer."):(null==a?void 0:a.includes("REFERRED-SELF"))?r("cancellation.reason.referred-self","The customer is referring themselves."):(null==a?void 0:a.includes("DUPLICATE-REFEREE-OFFER"))?r("cancellation.reason.duplicate","The customer already has an existing offer."):(null==a?void 0:a.includes("VOIDED-AS-TOO-OLD"))?r("cancellation.reason.too-old","The customer could not be fulfilled within 60 days."):(0,i.jsxs)(i.Fragment,{children:["(",a,")"]}),[r,a,n]);return null===s?null:(0,i.jsxs)(i.Fragment,{children:[r("cancellation.reason.prefix","We cancelled this introduction.")," ",s]})};v.__docgenInfo={description:"Ideally we'd have stored all the cancellation statuses in a nice enum or something which neatly maps to friendly\nerror messages.\n\nAlas, we have done no such thing and stored a string which can be ... wild.\n\nThis attempts to parse those strings into something human friendly.",methods:[],displayName:"CancellationReason",props:{referee:{required:!0,tsType:{name:"Pick",elements:[{name:"Referee"},{name:"union",raw:'"id" | "matchedViaMethod" | "authorisedByUser"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"matchedViaMethod"'},{name:"literal",value:'"authorisedByUser"'}]}],raw:'Pick<Referee, "id" | "matchedViaMethod" | "authorisedByUser">'},description:""}}};let y=e=>"matchedViaMethod"in e,h=e=>{let{approvable:a,objectType:n}=e,{t:p}=(0,l.$G)("customer"),m=a.authorisedByUser,u=m?`${m.firstname} ${m.surname} (${m.email})`:p("activity.approvable.authorisedBy.automated","platform automatically"),h=(0,t.useMemo)(()=>{if(a.isPendingApproval)return(0,i.jsx)(r.__,{variant:"status",status:"neutral",children:p("activity.approvable.isPending.message","Awaiting approval")});if(a.approvedDate)return(0,i.jsx)(r.__,{variant:"status",status:"positive",children:p("activity.approvable.approved","Approved by {{authorisedBy}}",{authorisedBy:u})});if(a.declinedDate)return!a.authorisedByUser&&a.isSuspectedOfGaming?(0,i.jsxs)(r.__,{variant:"status",status:"negative",children:[p("activity.approvable.declined_by_gaming_rules","Declined automatically by gaming rules")," ",(0,i.jsx)(c,{approvable:a,objectType:n,helpMessage:p("activity.approvable.approve_anyway.gaming","This person was automatically declined by gaming rules. You can override this decision and approve them anyway.")})]}):(0,i.jsxs)(r.__,{variant:"status",status:"negative",children:[p("activity.approvable.declined","Declined by {{authorisedBy}}",{authorisedBy:u}),(0,i.jsx)(c,{approvable:a,objectType:n,helpMessage:p("activity.approvable.approve_anyway.other","This person was declined. You can override this decision and approve them anyway.")}),(0,i.jsx)("br",{}),y(a)&&a.isVoid?(0,i.jsx)(v,{referee:a}):null]});return a.cancelledDate?(0,i.jsxs)(r.__,{variant:"status",status:"negative",children:[p("activity.approvable.cancelled","Cancelled by {{authorisedBy}}",{authorisedBy:u}),(0,i.jsx)("br",{}),y(a)&&a.isVoid?(0,i.jsx)(v,{referee:a}):null]}):null},[a,p,u,n]),_=(0,t.useMemo)(()=>a.isPendingApproval?(0,i.jsx)(s.WW,{message:p("activity.approvable.isPending.help","You can approve them from their approval list below")}):null,[a,p]);return null===h?null:(0,i.jsxs)("span",{children:[(0,i.jsx)(r.M2,{shouldWrap:a.approvalReason&&a.approvalReason.length>0||!!a.approvedDate||!!a.declinedDate,wrapper:e=>(0,i.jsx)(r.u,{tooltip:(0,i.jsxs)(i.Fragment,{children:[a.approvedDate&&(0,i.jsxs)(l.cC,{t:p,i18nKey:"activity.approvable.label.approved.tooltip",children:["Approved on"," ",(0,i.jsx)(o.Z,{date:a.approvedDate,format:"d MMM yyyy HH:mm:ss"})]}),a.declinedDate&&(0,i.jsxs)(l.cC,{t:p,i18nKey:"activity.approvable.label.declined.tooltip",children:["Declined on"," ",(0,i.jsx)(o.Z,{date:a.declinedDate,format:"d MMM yyyy HH:mm:ss"})]}),a.approvalReason&&(0,i.jsx)(d.Z,{approvable:a})]}),children:e}),children:h}),_]})},_=h;h.__docgenInfo={description:"",methods:[],displayName:"ApprovableEventLabels",props:{approvable:{required:!0,tsType:{name:"intersection",raw:'Pick<\n    Approvable,\n    | "id"\n    | "isPendingApproval"\n    | "isSuspectedOfGaming"\n    | "approvedDate"\n    | "declinedDate"\n    | "cancelledDate"\n    | "gamingScore"\n    | "approvalReason"\n> & {\n    authorisedByUser?: Maybe<Pick<User, "id" | "firstname" | "surname" | "email">>;\n}',elements:[{name:"Pick",elements:[{name:"Approvable"},{name:"union",raw:'| "id"\n| "isPendingApproval"\n| "isSuspectedOfGaming"\n| "approvedDate"\n| "declinedDate"\n| "cancelledDate"\n| "gamingScore"\n| "approvalReason"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"isPendingApproval"'},{name:"literal",value:'"isSuspectedOfGaming"'},{name:"literal",value:'"approvedDate"'},{name:"literal",value:'"declinedDate"'},{name:"literal",value:'"cancelledDate"'},{name:"literal",value:'"gamingScore"'},{name:"literal",value:'"approvalReason"'}]}],raw:'Pick<\n    Approvable,\n    | "id"\n    | "isPendingApproval"\n    | "isSuspectedOfGaming"\n    | "approvedDate"\n    | "declinedDate"\n    | "cancelledDate"\n    | "gamingScore"\n    | "approvalReason"\n>'},{name:"signature",type:"object",raw:'{\n    authorisedByUser?: Maybe<Pick<User, "id" | "firstname" | "surname" | "email">>;\n}',signature:{properties:[{key:"authorisedByUser",value:{name:"union",raw:"T | null",elements:[{name:"Pick",elements:[{name:"User"},{name:"union",raw:'"id" | "firstname" | "surname" | "email"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"firstname"'},{name:"literal",value:'"surname"'},{name:"literal",value:'"email"'}]}],raw:'Pick<User, "id" | "firstname" | "surname" | "email">'},{name:"null"}],required:!1}}]}}]},description:""},objectType:{required:!0,tsType:{name:"ApprovableObjectEnum"},description:""}}}},"./src/client/customer/utilities/getApprovalId.ts":function(e,a,n){n.d(a,{Z:function(){return i}});let i=e=>{let a;if(!(a="string"==typeof e?e:e.id))return"";let n=a.split("-");if(2!==n.length)throw Error(`Invalid approvable id: ${a}. Expected Approvable-ID, e.g. Referee-1234`);return n[1]}},"./src/shared/components/DateFormat/index.ts":function(e,a,n){n.d(a,{Z:()=>d});var i=n("../node_modules/react/jsx-runtime.js"),t=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),r=n("../node_modules/react/index.js"),l=n("../node_modules/react-i18next/dist/es/index.js");let s=e=>{let{date:a,updateFrequency:n}=e,{t:s}=(0,l.$G)("shared"),[o,d]=(0,r.useState)(Date.now());(0,r.useEffect)(()=>{let e;return n&&(e=setInterval(()=>{d(Date.now())},n)),()=>{e&&clearInterval(e)}},[n]);let p=new Date(a).getTime(),m=Math.floor((o-p)/1e3),u="",c="some time ago";o<=p&&(m=Math.floor((p-o)/1e3),u=".future",c="in a bit");let v=Math.floor(m/60),y=Math.floor(v/60),h=Math.floor(y/24),_=Math.floor(h/30),g=Math.floor(h/365),R=s(`shared:date.fromNow${u}.justNow`,c);return g>0?R=s(`shared:date.fromNow${u}.year`,c,{count:g}):_>0?R=s(`shared:date.fromNow${u}.month`,c,{count:_}):h>0&&h<7?R=s(`shared:date.fromNow${u}.days_and_hours`,c,{days:h,hours:y%24}):h>=7?R=s(`shared:date.fromNow${u}.day`,c,{count:h}):y>0?R=s(`shared:date.fromNow${u}.hour`,c,{count:y}):v>0?R=s(`shared:date.fromNow${u}.minute`,c,{count:v}):m>0&&(R=s(`shared:date.fromNow${u}.second`,c,{count:m})),(0,r.useMemo)(()=>(0,i.jsx)(t.u,{tooltip:(0,t.k2)(a),children:(0,i.jsx)("span",{children:R})}),[R,a])},o=e=>{let{variant:a,date:n,format:r,useDateIfOlderThan:l=864e5,shouldUpdateEverySecond:o}=e;if(!n)return null;let d=new Date(n);if(d){if("fromNow"===a){let e=new Date().getTime(),a=d.getTime();if(!l||e-a<l)return(0,i.jsx)(s,{date:d,updateFrequency:o?1e3:0})}return(0,i.jsx)(i.Fragment,{children:(0,t.p6)(n,r?{notation:"custom",format:r}:{notation:"short"})})}return null};o.__docgenInfo={description:"",methods:[],displayName:"DateFormat",props:{date:{required:!1,tsType:{name:"union",raw:"T | null",elements:[{name:"union",raw:"Date | string",elements:[{name:"Date"},{name:"string"}]},{name:"null"}]},description:""},format:{required:!1,tsType:{name:"string"},description:""},variant:{required:!1,tsType:{name:"literal",value:'"fromNow"'},description:""},useDateIfOlderThan:{required:!1,tsType:{name:"number"},description:'If the number of milliseconds is greater than this, we\'ll just display the date and not do the "fromNow" bit.\n\nIt\'s sometimes not very helpful to display "1 month ago", and easier to display "7th Jan".',defaultValue:{value:"86400000",computed:!1}},shouldUpdateEverySecond:{required:!1,tsType:{name:"boolean"},description:"Should we re-render this component every second? By default, we won't - but in places where it's useful to show\ntime progressing (e.g. a page that live renders recent data) it's useful to set this."}}};let d=o},"./src/user/types/RoleType.ts":function(e,a,n){n.d(a,{Z:function(){return i}});let i={ROLE_MERCHANT_PERFORMANCE:"ROLE_MERCHANT_PERFORMANCE",ROLE_MERCHANT:"ROLE_MERCHANT",ROLE_MERCHANT_CS:"ROLE_MERCHANT_CS",ROLE_MERCHANT_CS_SUPERVISOR:"ROLE_MERCHANT_CS_SUPERVISOR",ROLE_MERCHANT_CS_NO_APPROVAL:"ROLE_MERCHANT_CS_NO_APPROVAL",ROLE_MERCHANT_ADMIN:"ROLE_MERCHANT_ADMIN",ROLE_MERCHANT_DESIGNER:"ROLE_MERCHANT_DESIGNER",ROLE_MERCHANT_DEMO_VIEWER:"ROLE_MERCHANT_DEMO_VIEWER",IS_IMPERSONATOR:"IS_IMPERSONATOR",ROLE_MM_EMPLOYEE:"ROLE_MM_EMPLOYEE",ROLE_MM_SALES:"ROLE_MM_SALES",ROLE_MM_SALES_LIVE:"ROLE_MM_SALES_LIVE",ROLE_MM_MARKETING:"ROLE_MM_MARKETING",ROLE_MM_CSM:"ROLE_MM_CSM",ROLE_MM_TECH_OPS:"ROLE_MM_TECH_OPS",ROLE_MM_GDPR_ACTIONS:"ROLE_MM_GDPR_ACTIONS",ROLE_MM_SENIOR_OPERATIONS:"ROLE_MM_SENIOR_OPERATIONS",ROLE_MM_CSM_SENIOR_CROSS_MERCHANT_REPORTING:"ROLE_MM_CSM_SENIOR_CROSS_MERCHANT_REPORTING",ROLE_MM_ENGINEERING:"ROLE_MM_ENGINEERING",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN"}}}]);