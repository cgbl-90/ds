"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["9432"],{"./src/shared/components/Chart/ChartActions.module.less?d917":function(e,n,a){a.d(n,{Z:function(){return i}});let i={header:"header-yJvyjn",small:"small-p5iU1K",settings:"settings-xaOEkC",settingsButton:"settingsButton-ESyqqm",linkItem:"linkItem-pCd20V",annotationsToggle:"annotationsToggle-aJHCja",buttonItem:"buttonItem-s47MTE",addAnnotationForm:"addAnnotationForm-TviUNC",SingleDatePicker:"SingleDatePicker-uug18v",singleDatePicker:"SingleDatePicker-uug18v",heading:"heading-JS1Tln",chartActionButton:"chartActionButton-i22pyH",toggleLegendButton:"toggleLegendButton-stJDZV",expandButton:"expandButton-pH1yBV",downloadButton:"downloadButton-TGfGyI",dropdown:"dropdown-uMK81O",toggle:"toggle-cu9xUy"}},"./src/shared/components/Chart/AnnotationsModal.tsx":function(e,n,a){a.d(n,{Z:()=>_});var i,t,d=a("../node_modules/react/jsx-runtime.js"),o=a("../node_modules/react/index.js"),r=a("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),l=a("../node_modules/react-i18next/dist/es/index.js"),s=a("../node_modules/react-hook-form/dist/index.esm.mjs"),m=a("./src/shared/hooks/index.ts");let u="buttonsContainer-aalu6g";(i=t||(t={})).EDIT="edit",i.ADD="add";let c={id:"",eventDate:new Date().toISOString(),description:""},k=e=>{var n,a;let{className:i,onSubmit:t,onCancel:o,annotation:k={},merchantId:v,...p}=e,{t:h}=(0,l.$G)("reporting"),N=(0,m.EO)(v),g=(null==k?void 0:k.id)?"edit":"add",{register:y,handleSubmit:b,control:D,reset:S,formState:{errors:f,isValid:x}}=(0,s.cI)({mode:"all",defaultValues:{...c,...k}});return(0,d.jsx)("form",{className:i,onSubmit:b(e=>{t(e),"add"===g&&S()}),...p,children:(0,d.jsxs)(r.Zb,{variant:"slate",children:[(0,d.jsx)(s.Qr,{control:D,name:"eventDate",rules:{required:{value:!0,message:h("reporting:chart-annotations.form.errors.required-eventDate","Please select an event date")}},render:e=>{var n;let{field:{onChange:a,value:i},fieldState:{invalid:t,error:o}}=e;return(0,d.jsxs)(r.gN,{isInvalid:t,children:[(0,d.jsx)(r.gN.Label,{children:h("reporting:chart-annotations.form.event-date","Event Date")}),(0,d.jsx)(r.Wr,{selected:new Date(i),onChange:a,minDate:(null==N?void 0:null===(n=N.data)||void 0===n?void 0:n.officialStartDate)?new Date(N.data.officialStartDate):void 0}),(0,d.jsx)(r.gN.ErrorMessage,{children:null==o?void 0:o.message})]})}}),(0,d.jsxs)(r.gN,{isInvalid:!!f.description&&!!(null===(n=f.description)||void 0===n?void 0:n.message),children:[(0,d.jsx)(r.gN.Label,{children:h("reporting:chart-annotations.form.description","Description")}),(0,d.jsx)(r.oi,{"data-ph":"chart-annotation-form-description",...y("description",{required:"Description is a required field",maxLength:{value:255,message:h("reporting:chart-annotations.form.errors.description-max-length","Please enter a description shorter than 255 characters")}})}),(0,d.jsx)(r.gN.ErrorMessage,{children:null===(a=f.description)||void 0===a?void 0:a.message})]}),(0,d.jsxs)("div",{className:u,children:[o&&(0,d.jsx)(r.zx,{variant:"secondary",onClick:o,children:h("reporting:chart-annotations.actions.cancel","Cancel")}),(0,d.jsx)(r.zx,{type:"submit","data-ph":"chart-annotation-form-submit",disabled:!x,children:h(`reporting:chart-annotations.actions.${g}.button`,"Add new annotation")})]})]})})};k.__docgenInfo={description:"",methods:[],displayName:"ChartAnnotationsForm",props:{annotation:{defaultValue:{value:"{}",computed:!1},required:!1}}};var v=a("../node_modules/@apollo/client/react/hooks/useMutation.js"),p=a("../node_modules/date-fns/format.mjs"),h=a("../node_modules/nanoid/index.browser.js"),N=a("./src/shared/context/NotificationContext.tsx"),g=a("./src/user/hooks/useActiveUserState.ts");let y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"addChartAnnotation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventDate"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"description"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"merchantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"add_chartAnnotation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventDate"},value:{kind:"Variable",name:{kind:"Name",value:"eventDate"}}},{kind:"Argument",name:{kind:"Name",value:"description"},value:{kind:"Variable",name:{kind:"Name",value:"description"}}},{kind:"Argument",name:{kind:"Name",value:"merchantId"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdDate"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"eventDate"}},{kind:"Field",name:{kind:"Name",value:"createdBy"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}}]},b={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chartAnnotations"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"merchantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAnnotations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"merchantId"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ChartAnnotation"}}]}},{kind:"Field",name:{kind:"Name",value:"merchant"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"merchantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"merchantName"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"merchants"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"merchantName"}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ChartAnnotation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChartAnnotation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"eventDate"}},{kind:"Field",name:{kind:"Name",value:"createdDate"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"createdBy"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]},D={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"deleteChartAnnotation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"delete_chartAnnotation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}]}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"editChartAnnotation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"description"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventDate"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chartAnnotation_edit"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"description"},value:{kind:"Variable",name:{kind:"Name",value:"description"}}},{kind:"Argument",name:{kind:"Name",value:"eventDate"},value:{kind:"Variable",name:{kind:"Name",value:"eventDate"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"eventDate"}}]}}]}}]},f=e=>{let{t:n}=(0,l.$G)("reporting"),{addErrorNotification:a}=(0,N.kE)(),{data:i}=(0,g.Z)(),[t]=(0,v.D)(y,{onError:()=>{a(n("reporting:chart-annotations.actions.add.error-heading","Error adding chart annotation"),n("reporting:chart-annotations.actions.add.error-message","There has been an error adding your chart annotation, please try again."))},optimisticResponse:n=>{let{description:a,eventDate:t}=n;return{__typename:"Mutation",add_chartAnnotation:{__typename:"ChartAnnotation",id:(0,h.x0)(),createdDate:new Date().toISOString(),eventDate:t,description:a,merchantId:e,createdBy:{__typename:"User",id:null==i?void 0:i.id,displayName:null==i?void 0:i.displayName}}}},update:(n,a)=>{let{data:i}=a,t=null==i?void 0:i.add_chartAnnotation,d={merchantId:e},o=n.readQuery({query:b,variables:d});n.writeQuery({query:b,variables:d,data:{__typename:"Query",...o,customAnnotations:[...o.customAnnotations||[],t]}})}}),d=(0,o.useCallback)(async n=>{let{description:a,eventDate:i}=n;await t({variables:{merchantId:e,description:a,eventDate:(0,p.WU)(new Date(i),"yyyy-MM-dd'T'HH:mm:ss'Z'")}})},[e,t]),[r]=(0,v.D)(S,{onError:()=>{a(n("reporting:chart-annotations.actions.edit.error-heading","Error editing chart annotation"),n("reporting:chart-annotations.actions.edit.error-message","There has been an error editing your chart annotation, please try again."))},optimisticResponse:e=>{let{id:n,description:a,eventDate:i}=e;return{__typename:"Mutation",chartAnnotation_edit:{__typename:"ChartAnnotation",id:n,eventDate:i,description:a}}}}),s=(0,o.useCallback)(async e=>{let{id:n,description:a,eventDate:i}=e;await r({variables:{id:n,description:a,eventDate:(0,p.WU)(new Date(i),"yyyy-MM-dd'T'HH:mm:ss'Z'")}})},[r]),[m]=(0,v.D)(D,{onError:()=>{a(n("reporting:chart-annotations.actions.delete.error-heading","Error adding chart annotation"),n("reporting:chart-annotations.actions.delete.error-message","There has been an error deleting your chart annotation, please try again."))},optimisticResponse:()=>({__typename:"Mutation",delete_chartAnnotation:!0})});return{addChartAnnotation:d,editChartAnnotation:s,deleteChartAnnotation:(0,o.useCallback)(async e=>{await m({variables:{id:e},update:n=>{n.modify({fields:{chartAnnotations:function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{readField:a}=arguments.length>1?arguments[1]:void 0;return n.filter(n=>a("id",n)!==e)}}})}})},[m])}};var x=a("./src/shared/components/Chart/ChartActions.module.less?d917");let A=e=>{let{merchantId:n,isOpen:a,closeModal:i}=e,{t}=(0,l.$G)("reporting"),{addChartAnnotation:s}=f(n),m=(0,o.useCallback)(e=>{s(e),window.location.reload()},[s]);return(0,d.jsx)(r.u_,{isOpen:a,onClose:i,modalSize:"md",children:(0,d.jsxs)(r.u_.Content,{children:[(0,d.jsxs)(r.u_.Header,{children:[(0,d.jsx)(r.H5,{children:t("reporting:chart-annotations.add-modal-title","Add annotation")}),(0,d.jsx)(r.u_.CloseButton,{})]}),(0,d.jsxs)(r.u_.Body,{children:[(0,d.jsx)(r.M,{children:t("reporting:chart-annotations.add-modal-description","Use this to add custom annotations to the charts. This list is shown on all charts for when the time period allows.")}),(0,d.jsx)("br",{}),(0,d.jsx)(k,{className:x.Z.addAnnotationForm,merchantId:n,onSubmit:m,onCancel:i})]})]})})},_=A;A.__docgenInfo={description:"",methods:[],displayName:"AnnotationsModal",props:{merchantId:{required:!0,tsType:{name:"string"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},closeModal:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}}}}]);