"use strict";(globalThis.webpackChunk_mention_me_frontend=globalThis.webpackChunk_mention_me_frontend||[]).push([["4537"],{"./src/shared/components/Chart/ChartInternal.tsx":function(e,t,n){n.r(t),n.d(t,{default:()=>K});var a=n("../node_modules/react/jsx-runtime.js"),r=n("../node_modules/react/index.js"),o=n("../node_modules/classnames/index.js"),l=n.n(o),i=n("../node_modules/lodash/lodash.js"),s=n("../node_modules/@amcharts/amcharts4/core.js"),d=n("../node_modules/@amcharts/amcharts4/themes/animated.js"),u=n("../node_modules/react-router/esm/react-router.js"),c=n("./src/shared/utilities/error.ts");let h=()=>{let e=null;try{if(!(e=new URLSearchParams(window.location.search).get("merchantid"))){var t,n;let a=(0,u.LX)(window.location.pathname,{path:"/merchant/:merchantId/*"});e=!a||Number.isNaN(Number(null===(t=a.params)||void 0===t?void 0:t.merchantId))?null:null===(n=a.params)||void 0===n?void 0:n.merchantId}}catch(e){(0,c.eK)("getMerchantId",e)}return e},{userAgent:p}=window.navigator,g=p.includes("isMSIE "),m=p.includes("Trident/"),x=g||m;var v=n("../node_modules/@mention-me/flamingo-ui/build/index.es.js"),f=n("../node_modules/react-i18next/dist/es/index.js"),b=n("./src/shared/hooks/usePostHog/index.ts"),w=n("./src/shared/hooks/useUserCustomPreference/index.ts"),y=n("./src/shared/utilities/index.ts"),k=n("./src/shared/components/ToggleSwitch/index.ts"),j=n("./src/shared/components/Chart/AnnotationsModal.tsx");let C=e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16",...e,children:(0,a.jsx)("path",{stroke:"#888",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M1.334 11.333v.833a2.5 2.5 0 0 0 2.5 2.5h8.333a2.5 2.5 0 0 0 2.5-2.5v-.833m-3.333-3.334-3.333 3.334m0 0L4.667 7.999m3.334 3.334v-10"})}),_=e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",viewBox:"0 0 18 18",...e,children:(0,a.jsx)("path",{stroke:"#757575",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 4.556V1h-3.555M17 1l-6.222 6.222M1 13.444V17h3.555M1 17l6.222-6.222"})});var A=n("./src/shared/components/Chart/ChartActions.module.less?d917");let M=e=>{let{config:t}=e,{t:n}=(0,f.$G)("reporting"),r=(null==t?void 0:t.isVisible)?n("reporting:chart.hide-legend","Hide legend"):n("reporting:chart.show-legend","Show legend");return(null==t?void 0:t.isActive)?(0,a.jsx)(v.zx,{variant:"outline",className:A.Z.toggleLegendButton,title:r,style:{width:"auto",display:"flex",alignItems:"center",minWidth:"96px",justifyContent:"center"},onClick:e=>{e.preventDefault(),t.toggle()},children:r}):null},I=e=>{let{onClick:t,shouldDisplay:n}=e,{t:r}=(0,f.$G)("reporting");return n&&t?(0,a.jsx)(v.zx,{className:A.Z.downloadButton,onClick:e=>{e.preventDefault(),t()},title:r("reporting:chart.download-image","Download as image"),children:(0,a.jsx)(C,{})}):null},T=e=>{let{shouldDisplay:t,onClick:n}=e,{t:r}=(0,f.$G)("reporting");return t?(0,a.jsx)(v.zx,{className:A.Z.expandButton,onClick:n,title:r("reporting:chart.expand","Expand chart"),children:(0,a.jsx)(_,{})}):null},L=e=>{let{chartConfig:t,merchantId:n,isExpandMode:o,shouldShowDownloadImage:i=!0,downloadImageCallback:s,togglableLegend:d,onToggleAnnotations:u,openModal:c}=e,{t:h}=(0,f.$G)("reporting"),{postHog:p}=(0,b.U)(),[g,m]=(0,w.Z)("global-chart-annotations",!1);(0,r.useEffect)(()=>{null==u||u(g)},[g,u]);let[x,C]=(0,v.OT)(),_=(0,r.useMemo)(()=>((null==t?void 0:t.xAxes)??[]).some(e=>"DateAxis"===e.type),[t])&&n;return(0,a.jsxs)("div",{className:l()(A.Z.settings,"chart-settings"),"data-ph":"chart-settings",children:[_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{isOpen:x,closeModal:C.close,merchantId:n}),(0,a.jsxs)(v.Lt,{variant:"outline",label:h("annotations-dropdown.label","Annotations"),className:A.Z.dropdown,children:[(0,a.jsxs)(v.Lt.Button,{onClick:e=>e.stopPropagation(),children:[h("show-annotations.label","Show annotations"),(0,a.jsx)(k.Z,{className:A.Z.toggle,isChecked:g,onChange:e=>{e.target.checked?null==p||p.capture("annotations-enable"):null==p||p.capture("annotations-disable"),m(e.target.checked)}})]}),!o&&(0,a.jsx)(v.Lt.Button,{onClick:C.open,children:h("add-annotations.label","Add new annotation")}),(0,a.jsx)(v.Lt.Link,{className:A.Z.linkItem,href:(0,y.nu)("fe_merchant_chart_annotations",{merchantId:n}),children:h("manage-annotations.label","Manage annotations")})]})]}),(0,a.jsx)(I,{onClick:s,shouldDisplay:i}),(0,a.jsx)(M,{config:d}),(0,a.jsx)(T,{shouldDisplay:!o,onClick:c})]})};L.__docgenInfo={description:"",methods:[],displayName:"ChartActions",props:{chartConfig:{required:!1,tsType:{name:"any"},description:""},onToggleAnnotations:{required:!1,tsType:{name:"signature",type:"function",raw:"(show: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"show"}],return:{name:"void"}}},description:""},merchantId:{required:!1,tsType:{name:"string"},description:""},openModal:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},isExpandMode:{required:!1,tsType:{name:"boolean"},description:""},shouldShowDownloadImage:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},downloadImageCallback:{required:!1,tsType:{name:"any"},description:""},togglableLegend:{required:!1,tsType:{name:"TogglableLegendConfig"},description:""}}};var Z=n("../node_modules/nanoid/index.browser.js");let N=e=>{let{chart:t}=e,n=(0,r.useRef)((0,Z.x0)()),[a,o]=(0,w.Z)("global-legend-visibility",!0),[l,i]=(0,r.useState)(!!a),d=(0,r.useCallback)(()=>{var e,a,r,o,l;let i=document.getElementById(n.current),s=null===(e=t.current)||void 0===e?void 0:e.legend;i&&["top","bottom"].includes(null==s?void 0:s.position)&&(i.style.height=`${((null===(r=t.current)||void 0===r?void 0:null===(a=r.legend)||void 0===a?void 0:a.contentHeight)||0)+40}px`),i&&["right","left"].includes(null==s?void 0:s.position)&&(i.style.width=`${((null===(l=t.current)||void 0===l?void 0:null===(o=l.legend)||void 0===o?void 0:o.contentWidth)||0)+40}px`)},[t]);return(0,r.useEffect)(()=>{setTimeout(()=>{d()},40)},[l,d,a]),{legendWrapperId:n,isLegendVisible:l,toggleLegendVisibility:()=>{i(e=>(o(!e),!e))},createLegendContainer:()=>{let e=s.Ue8(n.current,s.W20);return e.width=s.aQA(100),e.height=s.aQA(100),e}}};var S=n("../node_modules/@amcharts/amcharts4/charts.js");let W=e=>void 0!==(null==e?void 0:e.xAxes)&&(null==e?void 0:e.xAxes),$=e=>{if("PieChart"===e)return S.uc;return S.zO};s.YMi.queue=!0,s.YMi.onlyShowOnViewport=!0,s.YMi.autoSetClassName=!0,s.cPR("CH353963140"),!x&&s.FgM(d.Z);let E=e=>{W(e)&&e.xAxes.each(e=>{let t=e=>{let t=e.target,n=((null==t?void 0:t.pixelWidth)||0)/(t.endIndex-t.startIndex),{template:a}=t.renderer.labels;a.maxWidth=n,(n<=30||t.pixelWidth<400)&&(a.rotation=-30,a.horizontalCenter="right",a.verticalCenter="middle",a.wrap=!1)};e.events.on("sizechanged",t),e.events.on("datarangechanged",t)})},R=e=>{e.legend&&e.legend.markers.template.children.each((e,t)=>{let n=e.states.getKey("active");0===t?n&&(n.properties.strokeWidth=.5,n.properties.stroke=s.$_Y("#000"),n.properties.strokeOpacity=1,n.adapter.add("fill",()=>s.$_Y("#FFF"))):n&&(n.properties.opacity=0,n.properties.fillOpacity=0,n.properties.strokeOpacity=0)})},P=(e,t)=>{if(void 0===t)return"";if("[default]"!==t)return t;let n="[bold #757575]{categoryX}[/]\n";if(e.series.length>10)return n+="[#757575 line-height:10px vertical-align:top]{name}: [/][#757575 line-height:10px vertical-align:top text-align:right]{valueY}[/]";let a=!1;return(e.series.each(e=>{e.dataFields.valueY.includes("(")&&(a=!0)}),a)?n+="[#757575 line-height:10px vertical-align:top]{name}: [/][#757575 line-height:10px vertical-align:top text-align:right]{valueY}[/]":(e.series.each(e=>{n+=`[font-size:18px ${e.stroke.hex} ]â– [/] [#757575] ${e.name} : [bold #757575 vertical-align:top text-align:right]`;let{numberFormat:t}=e.yAxis.numberFormatter,a=`{valueY.formatNumber("${t}")}`;n+=a.replace("valueY",e.dataFields.valueY),n+="[/]\n"}),n)},Y=e=>{e.series.each(t=>{t.tooltip&&(t.tooltip.label.fill=s.$_Y("#757575"),t.tooltip.label.fontSize=12,t.tooltip.label.stroke=s.$_Y("#757575"),t.tooltip.label.strokeWidth=.1);t.columns&&t.columns.template&&t.columns.template.adapter.add("tooltipText",t=>P(e,t)),t.bullets&&t.bullets.each(t=>{t.adapter.add("tooltipText",t=>P(e,t)),"ErrorBullet"===t._className&&(t.adapter.add("pixelHeight",(t,n)=>{let{dataItem:a}=n;if(a&&W(e)){let t=e.xAxes.getIndex(0),n=a.dataContext.error_bar_high,r=t.valueToPoint(n).x,o=a.dataContext.error_bar_low;return Math.abs(r-t.valueToPoint(o).x)}return t}),t.adapter.add("dy",(t,n)=>{let{dataItem:a}=n;if(a&&W(e)){let t=a.valueX,n=e.xAxes.getIndex(0),r=a.dataContext.error_bar_high,o=n.valueToPoint(r).x,l=a.dataContext.error_bar_low,i=n.valueToPoint(l).x,s=n.valueToPoint(t).x;return(o-s)/2-(s-i)/2}return t}))})})},q=e=>{E(e),R(e),Y(e)},O=e=>{let t;var n=void 0;let a=!1;return function(){for(var r=arguments.length,o=Array(r),l=0;l<r;l++)o[l]=arguments[l];return!a&&(a=!0,t=e.apply(n,o)),t}},D=e=>e.xAxes.values.some(e=>e instanceof S.SO),z=e=>{let t=O(e=>{var t,n,a;if(!window.posthog)return;let r=null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.tooltipText;if(r){let[,...e]=r.match(/^\[[a-z0-9:#\- ]+]([\S ]+)\[\/]\n\[[a-z0-9:#\- ]+]([\S ]+)\[\/]$/);r=e.map(e=>e.trim()).join(", ")}null===(a=window)||void 0===a||null===(n=a.posthog)||void 0===n||n.capture("chart-annotation-hover",{tooltipText:r})});e.xAxes.values.filter(e=>e.axisRanges).forEach(e=>{e.axisRanges.each(e=>{e.bullet.events.on("over",t)})})},B=e=>{if(!D(e))return;let t=e.yAxes.getIndex(0),n=null==t?void 0:t.axisRanges.create();n&&(n.grid.stroke=s.$_Y("#A5A5A5"),n.grid.strokeWidth=1,n.grid.strokeOpacity=.5,n.grid.dy=20,n.grid.strokeDasharray="2,2",n.label.disabled=!0)},F=e=>{let{yAxes:t,xAxes:n}=e;t.values.forEach(e=>{e.axisRanges.each(e=>{e.hide()})}),n.values.filter(e=>e instanceof S.SO).forEach(e=>{e.axisRanges.each(e=>{e.hide()}),e.renderer.labels.template.dy=0})},V=e=>{let{yAxes:t,xAxes:n}=e;t.values.forEach(e=>{e.axisRanges.each(e=>{e.show()})}),n.values.filter(e=>e instanceof S.SO).forEach(e=>{e.axisRanges.each(e=>{e.show()}),e.renderer.labels.template.dy=20,e.title.dy=15})},H=e=>{W(e)&&(B(e),z(e),F(e))};var G=n("./src/shared/components/Chart/ChartInternal.module.less?712b");!x&&s.FgM(d.Z);let U={left:G.Z.chartWrapperLegendLeft,right:G.Z.chartWrapperLegendRight,top:G.Z.chartWrapperLegendTop,bottom:G.Z.chartWrapperLegendBottom},X=(0,r.forwardRef)((e,t)=>{var n;let{config:o,data:u,annotations:c,amChartType:p,className:g,chartHeight:m,title:v,subTitle:f,isExpandMode:b,openModal:w,shouldShowDownloadImage:y,hasTogglableLegend:k,isAnimated:j=!0,shouldShowHeader:C=!0,..._}=e,A=(0,r.useRef)(null),M=(0,r.useRef)(null);!j||x?s.uqc(d.Z):s.FgM(d.Z);let{toggleLegendVisibility:I,isLegendVisible:T,legendWrapperId:Z,createLegendContainer:S}=N({chart:M});(0,r.useImperativeHandle)(t,()=>({export:(e,t)=>M.current?(M.current.exporting.filePrefix="MentionMeChart",M.current.exporting.export(e,t)):Promise.resolve(!1)}),[]);let E=(0,r.useCallback)(()=>{M.current&&(M.current.exporting.filePrefix="MentionMeChart",M.current.exporting.export("png"))},[]);(0,r.useLayoutEffect)(()=>{var e;let t=(0,i.cloneDeep)(o);if(!t&&!u)return;c&&((null==t?void 0:t.xAxes)??[]).forEach(e=>{"DateAxis"===e.type&&(e.axisRanges=c)});let n=s.SMO(t||{},A.current||void 0,$(p));return c&&H(n),k&&(null===(e=n.legend)||void 0===e?void 0:e.parent)&&(n.legend.parent=S()),q(n),n.data=u||[],M.current=n,()=>{var e;null===(e=n.legend)||void 0===e||e.dispose(),n.dispose()}},[p,o,u,c,t,S,k]);let R=(0,r.useCallback)(e=>{if(!!W(M.current))e?V(M.current):F(M.current)},[]),P=(0,r.useMemo)(()=>m?{height:"number"==typeof m?`${m}px`:m}:{},[m]),Y=h();return(0,a.jsxs)("div",{className:g,..._,children:[C&&(0,a.jsxs)("div",{className:G.Z.header,children:[(0,a.jsxs)("div",{className:G.Z.titles,children:[v,f]}),(0,a.jsx)(L,{downloadImageCallback:E,chartConfig:o,onToggleAnnotations:R,merchantId:Y||void 0,openModal:w,isExpandMode:b,shouldShowDownloadImage:y,togglableLegend:{isVisible:T,isActive:!!k&&!!(null==o?void 0:o.legend),toggle:I}})]}),(0,a.jsxs)("div",{className:l()(G.Z.chartWrapper,{[U[(null==o?void 0:null===(n=o.legend)||void 0===n?void 0:n.position)||"bottom"]]:!!k}),children:[(0,a.jsx)("div",{className:G.Z.chart,ref:A,style:P}),(0,a.jsx)("div",{id:Z.current,className:l()({[G.Z.customChartLegendHidden]:!T||!k})})]})]})}),K=(0,r.memo)(X);X.__docgenInfo={description:"",methods:[{name:"export",docblock:null,modifiers:[],params:[{name:"type",optional:!1,type:null},{name:"options",optional:!1,type:null}],returns:null}],displayName:"ChartInternal",props:{isAnimated:{defaultValue:{value:"true",computed:!1},required:!1},shouldShowHeader:{defaultValue:{value:"true",computed:!1},required:!1}}}}}]);